<!DOCTYPE html>

<html lang="en-us">
    <head>
        <title>Animal, Vegetable, Mineral</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="/avm/css/main.css">

        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Open+Sans:ital,wght@0,300;0,400;0,600;0,700;0,800;1,300;1,400;1,600;1,700;1,800&display=swap" rel="stylesheet">
        <script src="https://kit.fontawesome.com/576aa28f15.js" crossorigin="anonymous"></script>

        <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
        <script>
        
            $(document).ready(function() {
                //$("#query").focus()
            })

            $(document).on("click",".btn-submit", function() {
                avm()
            })

            var fade = false
            function avm() {
                // Don't do this. As I was writing this, I realized that I don't know how to do 
                // AJAX without doing it the really, really old way. I'm a designer not a coder.
                // Do this the best way possible in your framework. Also maybe put in some security...
                // I used to hate it when my text books would say that, but now I totally get it.
                // The PHP file just returns JSON. Having had to do a bridge function in PHP, I probably
                // would have just written the whole thing in PHP but I didn't. It's in Node with a weird
                // PHP bridge to JSON because... God I'm old.

                // Anyway it's fine for the sake of the example so if you want to just install this code
                // and run it, it will actually work (something my textbooks didn't offer at the time).

                var val = document.getElementById("query").value

                if (val) {
                    // send to server
                    $.ajax({
                        type: 'GET',
                        dataType: 'json',
                        url: 'https://alanunderwood.com/avm/avm.php?q=' + val,
                        data: val,
                        success: function (result) {
                            var res = result.result
                            $("#result").hide()

                            document.getElementById("result").innerHTML = res

                            if (!(fade)) {
                                $("#result").slideDown(250)
                                fade = true
                            } else {
                                $("#result").show()
                            }

                            $("#train").hide()
                            $("#train-result").hide()
                            $("#correct").hide()

                            if (res.toLowerCase() != "unknown") {
                                $("#train").fadeIn(100)
                            } else {
                                $("#correct").fadeIn(100)
                            }

                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            console.log(xhr.status)
                            console.log(thrownError)
                        }
                    })
                }

                return false // don't submit that form
            }

            function correct() {
                var frm = document.forms["correction"]
                var avm = frm.avm.value
                var word = document.getElementById("query").value
                
                if (avm) {
                    trainSave(word, avm)
                }

                return false // don't submit this form either
            }

            function trainNo() {
                $("#correct").show()
                $("#train").hide()

                return false
            }

            function trainYes() {
                var avm = $("#result").text().toLowerCase()
                console.log(avm)
                var word = document.getElementById("query").value

                trainSave(word,avm)

                $("#train").fadeOut(100)
                $("#start").fadeOut(150)
                $("#train-result").fadeIn(500)

                setTimeout(function() {
                    window.location = "/avm"
                }, 500)

                return false
            }

            function trainSave(word, category) {
                avm = category.toLowerCase();

                var runAjax = false
                switch(avm) {
                    case "animal":
                        runAjax = true
                        break
                    case "vegetable": 
                        runAjax = true
                        break
                    case "mineral":
                        runAjax = true
                        break
                }

                var postURL = 'https://alanunderwood.com/avm/train.php?word=' + word + '&category=' + avm

                var data = []
                data["word"] =  word
                data["category"] = avm

                if (runAjax) {
                    $.ajax({
                        type: 'GET',
                        dataType: 'json',
                        url: postURL,
                        data: data,
                        success: function (result) {
                            var res = result.result

                            // Show completion message
                            $("#start").hide()
                            $("#result").hide()
                            $("#training").hide()
                            $("#train-result").show()

                            setTimeout(function() {
                                window.location = "/avm"
                            }, 500)
                        },
                        error: function(xhr, ajaxOptions, thrownError) {
                            $("#train-error").show()

                            console.log(xhr.status)
                            console.log(thrownError)
                        }
                    })
                    
                }
            }
        </script>

    </head>

    <body>

        <div class="layout">
            <header>
                <h1>Animal, Vegetable, or Mineral?</h1>
            </header>

            
            <div class="output">
                <article id="results">
                    <section class="result"><h3 id="result"></h3></section>
                </article>
            </div>
            
            <div class="training">
                <article id="training-results">
                    <section id="train-result">
                        <h3>Training Data Received!</h3>
                    </section>
            
                    <section id="train-error">
                        <h3>Training data error =(</h3>
                    </section>
                </article>

                <article id="training">
                    <section id="train">
                        <h2>Was this right?</h2>
                        <form id="yesno">
                            <button id="no" onclick="return trainNo()"><i class="fas fa-thumbs-down"></i></button>
                            <button id="yes" onclick="return trainYes()"><i class="fas fa-thumbs-up"></i></button>
                        </form>
                    </section>
            
                    <section id="correct">
                        <h2>What is the correct category?</h2>
                        <form id="correction" onsubmit="return correct()">
                            <input name="avm" type="radio" id="animal" value="Animal">
                            <label for="animal">Animal</label>
            
                            <input name="avm" type="radio" id="vegetable" value="Vegetable">
                            <label for="vegetable">Vegetable</label>
            
                            <input name="avm" type="radio" id="mineral" value="Mineral">
                            <label for="mineral">Mineral</label>
            
                            <input type="submit" class="correct-submit">
                        </form>
                    </section>
                </article>
            </div>
            
            <main>
                <article id="start">

                    <section id="intro">
                        <form onsubmit=" return avm()">
                            <div class="entry">
                                <p class="instructions">Enter a word and I'll guess if it's an animal, vegetable, or mineral!</p>

                                <div class="center">
                                    <label for="q">Enter a word</label>
                                    <input id="query" name="q" type="text" class="input" autocomplete="off">
                                    <input type="button" id="q-submit" name="btn-submit" value="Go!" onclick="return avm()">
                                </div>
                                
                            </div>        
                        </form>
                    </section>
                </article>
            </main>

            <div class="hr"><hr></div>

            <footer id="more-info">
                <h2>What is this?</h2>

                <p>
                    This is a naive bayesian classifier, which means that it's a very simple machine learning algorithm. 
                    It is designed to be a quick demonstration for people who want to learn more about machine learning but 
                    don't really know where to start. It works a lot like cleverbot except that instead of learning how to 
                    make conversation, it's learning to categorize using the old game animal, vegetable, or mineral.   
                </p>

                <p>
                    I have loaded the bot with several libraries of plants and animals and minerals, but it still has a lot to 
                    learn. When you enter a word that the bot doesn't know, instead of guessing, it will ask you whether it is 
                    an animal, a vegetable, or a mineral. Your feedback trains the bot and the next time you ask it that question 
                    (or someone else does) it may have a better guess than it did the last time. 
                </p>

                <p>
                    If it does know, or if it has a guess, it will tell you it's answer and ask you if it was correct. If it was 
                    right (and you tell it that it was right) it will use reinforcement learning to make stronger connections 
                    for that guess. If it was wrong you can re-train it to learn the right answer. 
                </p>

                <p>
                    Your feedback trains the bot!
                </p>

            </article>
        </div>

    </body>
</html>
